#!/bin/bash

# David Adams
# November 2015
#
# Script to test the raw data simulation module SimWireDune.

HELP=
CLEAN=
DBG=0
while getopts hcd: OPT; do
  case $OPT in
  h) HELP=true;;
  c) CLEAN=true;;
  d) DBG=$OPTARG;;
  esac
done
shift $(( OPTIND-1 ))
SAM1=$1
SAM2=$2
if [ -z "$SAM1" ]; then
  SAM1=mu35tnew
fi
if [ -z "$SAM2" ]; then
  SAM2=mu35tnewref
fi

if [ -n "$HELP" ]; then
  echo "Usage: $0 [-h] [-c] [-d VAL] [TEST_SAMPLE] [REF_SAMPLE]"
  echo   "-h: This message"
  echo   "-c: Remove old output before running"
  echo   "-d: Run comparison at debug level VAL"
  echo   "    VAL = 1 shows differing channels"
  exit 0
fi

if [ "$1" = clean -o -n "$CLEAN" ]; then
  echo Cleaning
  rm -f *.root
  rm -f *.log
  rm -f *.fcldump
  if [ "$1" = clean ]; then exit 0; fi
fi

# Compare histograms.
echo
echo Comparing histograms.
dxroot compareHists.C'("'$SAM1'","'$SAM2'",'$DBG')' 2>&1 | tee compare.log
STAT=$?
if [ $STAT -ne 0 ]; then
  Histogram comparison failed.
  exit 1
fi

echo
echo Done
